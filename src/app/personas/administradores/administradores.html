<!-- src/app/personas/administradores/administradores.html -->
<div class="min-h-screen bg-gray-50">

  <!-- ==========================================
       HEADER EJECUTIVO CON BREADCRUMB
       ========================================== -->
  <div class="bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">



      <!-- Header Principal -->
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between py-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="bg-blue-100 p-3 rounded-lg">
              <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"/>
              </svg>
            </div>
          </div>
          <div class="ml-4">
            <h1 class="text-3xl font-bold text-gray-900">Administradores</h1>
            <p class="text-gray-600 mt-1">
              Gestión de usuarios administrativos del sistema hospitalario
            </p>
            <div class="flex items-center mt-2 text-sm text-gray-500">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              Hospital General San Luis de la Paz
            </div>
          </div>
        </div>

        <!-- Acciones Principales -->
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-3 sm:space-y-0 sm:space-x-3 mt-6 lg:mt-0">
          <button (click)="recargarDatos()"
            class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Actualizar
          </button>

          <button *ngIf="puedeVerConfiguracion()" (click)="irAConfiguracion()"
            class="inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Configuración
          </button>

          <button (click)="mostrarFormularioCrear()"
            class="inline-flex items-center justify-center px-6 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors shadow-sm">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Nuevo Administrador
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==========================================
       ESTADÍSTICAS RÁPIDAS (OPCIONAL)
       ========================================== -->
  <div *ngIf="estadisticas" class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">

      <!-- Toggle de estadísticas -->
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">Resumen del Sistema</h3>
        <button (click)="toggleEstadisticas()"
          class="text-sm text-gray-500 hover:text-gray-700 focus:outline-none">
          {{ mostrarEstadisticas ? 'Ocultar' : 'Mostrar' }} detalles
        </button>
      </div>

      <!-- Grid de estadísticas -->
      <div *ngIf="mostrarEstadisticas" class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Total Administradores -->
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-blue-100 text-sm font-medium">Total</p>
              <p class="text-2xl font-bold">{{ estadisticas.total_administradores }}</p>
            </div>
            <div class="bg-blue-400 bg-opacity-50 rounded-lg p-2">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Administradores Activos -->
        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-green-100 text-sm font-medium">Activos</p>
              <p class="text-2xl font-bold">{{ estadisticas.administradores_activos }}</p>
            </div>
            <div class="bg-green-400 bg-opacity-50 rounded-lg p-2">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Administradores Inactivos -->
        <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-4 text-white">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-orange-100 text-sm font-medium">Inactivos</p>
              <p class="text-2xl font-bold">{{ estadisticas.administradores_inactivos }}</p>
            </div>
            <div class="bg-orange-400 bg-opacity-50 rounded-lg p-2">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Accesos del Mes -->
        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-4 text-white">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-purple-100 text-sm font-medium">Accesos Mes</p>
              <p class="text-2xl font-bold">{{ estadisticas.accesos_ultimo_mes }}</p>
            </div>
            <div class="bg-purple-400 bg-opacity-50 rounded-lg p-2">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==========================================
       PANEL DE CONTROL Y FILTROS
       ========================================== -->
  <div class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">

        <!-- Panel de búsqueda -->
        <div class="flex-1 max-w-lg">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>
            <div [formGroup]="filtrosForm">
              <input type="text" formControlName="buscar"
                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                placeholder="Buscar por nombre, usuario o email...">
            </div>
          </div>
        </div>

        <!-- Controles de vista y filtros -->
        <div class="flex items-center space-x-4">

          <!-- Filtros rápidos -->
          <div class="flex items-center space-x-3" [formGroup]="filtrosForm">
            <div class="flex items-center">
              <label class="text-sm font-medium text-gray-700 mr-2">Estado:</label>
              <select formControlName="activo"
                class="rounded-md border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                <option *ngFor="let opcion of opcionesActivo" [value]="opcion.valor">
                  {{ opcion.etiqueta }}
                </option>
              </select>
            </div>

            <div class="flex items-center">
              <label class="text-sm font-medium text-gray-700 mr-2">Nivel:</label>
              <select formControlName="nivel_acceso"
                class="rounded-md border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="">Todos</option>
                <option *ngFor="let nivel of nivelesAcceso" [value]="nivel.valor">
                  {{ nivel.etiqueta }}
                </option>
              </select>
            </div>
          </div>

          <!-- Divisor -->
          <div class="border-l border-gray-300 h-6"></div>

          <!-- Selector de vista -->
          <div class="flex items-center bg-gray-100 rounded-lg p-1">
            <button (click)="cambiarVista('tarjetas')"
              [class]="vistaActual === 'tarjetas' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-500 hover:text-gray-700'"
              class="p-2 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
            </button>
            <button (click)="cambiarVista('tabla')"
              [class]="vistaActual === 'tabla' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-500 hover:text-gray-700'"
              class="p-2 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
              </svg>
            </button>
          </div>

          <!-- Botones de acción -->
          <div class="flex items-center space-x-2">
            <button (click)="aplicarFiltros()"
              class="inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.121A1 1 0 013 6.414V4z"/>
              </svg>
              Filtrar
            </button>

            <button (click)="limpiarFiltros()"
              class="inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Limpiar
            </button>
          </div>
        </div>
      </div>

      <!-- Indicador de resultados -->
      <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200">
        <div class="flex items-center space-x-4">
          <span class="text-sm text-gray-700">
            <span class="font-medium">{{ totalAdministradores }}</span> administradores encontrados
          </span>
          <span *ngIf="hayFiltrosAplicados" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            Filtros activos
          </span>
        </div>

        <div class="text-sm text-gray-500">
  Última actualización: {{ formatearFecha(fechaActualizacion) }}
</div>
      </div>
    </div>
  </div>

  <!-- ==========================================
       MENSAJES DEL SISTEMA
       ========================================== -->
  <div *ngIf="error || success" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
    <!-- Mensaje de Error -->
    <div *ngIf="error" class="rounded-md bg-red-50 p-4 border border-red-200">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Error del Sistema</h3>
          <div class="mt-2 text-sm text-red-700">
            <p>{{ error }}</p>
          </div>
          <div class="mt-4">
            <button (click)="limpiarMensajes()" type="button"
              class="text-sm font-medium text-red-800 hover:text-red-600 focus:outline-none focus:underline">
              Cerrar mensaje
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de Éxito -->
    <div *ngIf="success" class="rounded-md bg-green-50 p-4 border border-green-200">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-green-800">Operación Exitosa</h3>
          <div class="mt-2 text-sm text-green-700">
            <p>{{ success }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==========================================
       CONTENIDO PRINCIPAL
       ========================================== -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

    <!-- Estado de Carga -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-16">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"></div>
      <p class="mt-4 text-lg font-medium text-gray-600">Cargando administradores...</p>
      <p class="text-sm text-gray-500 mt-1">Conectando con el sistema hospitalario</p>
    </div>

    <!-- Estado Vacío -->
    <div *ngIf="!loading && !hayAdministradores" class="text-center py-16">
      <div class="mx-auto h-24 w-24 bg-gray-100 rounded-full flex items-center justify-center">
        <svg class="h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"/>
        </svg>
      </div>
      <h3 class="mt-6 text-lg font-medium text-gray-900">No hay administradores registrados</h3>
      <p class="mt-2 text-gray-500 max-w-md mx-auto">
        Para comenzar, cree el primer administrador del sistema hospitalario. Este tendrá acceso completo a todas las funcionalidades.
      </p>
      <div class="mt-8">
        <button (click)="mostrarFormularioCrear()"
          class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Crear Primer Administrador
        </button>
      </div>
    </div>

    <!-- ==========================================
         VISTA DE TARJETAS MODERNAS
         ========================================== -->
    <div *ngIf="!loading && hayAdministradores && vistaActual === 'tarjetas'"
      class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">

      <div *ngFor="let admin of administradores; trackBy: trackByAdministradorId"
        class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-lg transition-all duration-200 overflow-hidden">

        <!-- Header de la tarjeta -->
        <div class="p-6 pb-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <!-- Avatar con iniciales -->
              <div class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg"
                [class]="obtenerColorPorNivel(admin.nivel_acceso)">
                {{ obtenerIconoPorNivel(admin.nivel_acceso) }}
              </div>
              <div class="ml-4">
                <h3 class="text-lg font-semibold text-gray-900">{{ admin.usuario }}</h3>
                <p class="text-sm text-gray-600">{{ construirNombreCompleto(admin) }}</p>
              </div>
            </div>

            <!-- Estado -->
            <div class="flex flex-col items-end">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [class]="obtenerClaseEstado(admin.activo)">
                <span class="w-1.5 h-1.5 rounded-full mr-1.5"
                  [class]="admin.activo ? 'bg-green-600' : 'bg-red-600'"></span>
                {{ obtenerTextoEstado(admin.activo) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Información de la tarjeta -->
        <div class="px-6 pb-4">
          <div class="space-y-3">

            <!-- Nivel de acceso -->
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium text-gray-500">Nivel de Acceso</span>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [class]="obtenerColorPorNivel(admin.nivel_acceso)">
                {{ admin.nivel_acceso }}
              </span>
            </div>

            <!-- Email -->
            <div *ngIf="admin.persona?.email" class="flex items-center justify-between">
             <span class="text-sm font-medium text-gray-500">Email</span>
             <span class="text-sm text-gray-900 truncate max-w-40">{{ admin.persona?.email }}</span>
           </div>

           <!-- Teléfono -->
           <div *ngIf="admin.persona?.telefono" class="flex items-center justify-between">
             <span class="text-sm font-medium text-gray-500">Teléfono</span>
             <span class="text-sm text-gray-900">{{ admin.persona?.telefono }}</span>
           </div>

           <!-- Último acceso -->
           <div class="flex items-center justify-between">
             <span class="text-sm font-medium text-gray-500">Último Acceso</span>
             <span class="text-sm text-gray-900">{{ formatearFecha(admin.ultimo_acceso || '') }}</span>
           </div>
         </div>
       </div>

       <!-- Acciones de la tarjeta -->
       <div class="bg-gray-50 px-6 py-4">
         <div class="flex items-center justify-between">
           <!-- Acciones principales -->
           <div class="flex items-center space-x-2">
             <button (click)="verPerfilCompleto(admin)"
               class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
               <svg class="w-3.5 h-3.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
               </svg>
               Ver
             </button>

             <button (click)="mostrarFormularioEditar(admin)"
               class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
               <svg class="w-3.5 h-3.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
               </svg>
               Editar
             </button>
           </div>

           <!-- Menú de acciones -->
           <div class="relative">
             <button class="inline-flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md"
               (click)="toggleMenuAcciones(admin.id_administrador)">
               <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                 <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
               </svg>
             </button>

             <!-- Dropdown de acciones -->
             <div *ngIf="menuAccionesAbierto === admin.id_administrador"
               class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
               <div class="py-1">
                 <button (click)="mostrarCambioPassword(admin)"
                   class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100">
                   <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                   </svg>
                   Cambiar Contraseña
                 </button>

                 <button (click)="cambiarEstado(admin)"
                   [class]="admin.activo ? 'text-orange-700 hover:bg-orange-50' : 'text-green-700 hover:bg-green-50'"
                   class="flex items-center w-full px-4 py-2 text-sm focus:outline-none">
                   <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
                   </svg>
                   {{ admin.activo ? 'Desactivar' : 'Activar' }}
                 </button>

                 <hr class="my-1">

                 <button (click)="eliminarAdministrador(admin)"
                   class="flex items-center w-full px-4 py-2 text-sm text-red-700 hover:bg-red-50 focus:outline-none focus:bg-red-50">
                   <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                   </svg>
                   Eliminar
                 </button>
               </div>
             </div>
           </div>
         </div>
       </div>
     </div>
   </div>

   <!-- ==========================================
        VISTA DE TABLA PROFESIONAL
        ========================================== -->
   <div *ngIf="!loading && hayAdministradores && vistaActual === 'tabla'"
     class="bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden">

     <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
         <thead class="bg-gray-50">
           <tr>
             <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
               <div class="flex items-center space-x-1">
                 <span>Administrador</span>
                 <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                 </svg>
               </div>
             </th>
             <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
               Información de Contacto
             </th>
             <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
               Nivel y Estado
             </th>
             <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
               Actividad
             </th>
             <th scope="col" class="relative px-6 py-4">
               <span class="sr-only">Acciones</span>
             </th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
           <tr *ngFor="let admin of administradores; trackBy: trackByAdministradorId"
             class="hover:bg-gray-50 transition-colors">

             <!-- Información del administrador -->
             <td class="px-6 py-4 whitespace-nowrap">
               <div class="flex items-center">
                 <div class="w-11 h-11 rounded-full flex items-center justify-center text-white font-bold text-sm"
                   [class]="obtenerColorPorNivel(admin.nivel_acceso)">
                   {{ obtenerIconoPorNivel(admin.nivel_acceso) }}
                 </div>
                 <div class="ml-4">
                   <div class="text-sm font-medium text-gray-900">{{ admin.usuario }}</div>
                   <div class="text-sm text-gray-500">{{ construirNombreCompleto(admin) }}</div>
                 </div>
               </div>
             </td>

             <!-- Información de contacto -->
             <td class="px-6 py-4 whitespace-nowrap">
               <div class="text-sm text-gray-900">
                 <div class="flex items-center">
                   <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                   </svg>
                   {{ admin.persona?.email || 'Sin email' }}
                 </div>
                 <div class="flex items-center mt-1">
                   <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                   </svg>
                   {{ admin.persona?.telefono || 'Sin teléfono' }}
                 </div>
               </div>
             </td>

             <!-- Nivel y estado -->
             <td class="px-6 py-4 whitespace-nowrap">
               <div class="space-y-2">
                 <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                   [class]="obtenerColorPorNivel(admin.nivel_acceso)">
                   {{ admin.nivel_acceso }}
                 </span>
                 <div>
                   <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                     [class]="obtenerClaseEstado(admin.activo)">
                     <span class="w-1.5 h-1.5 rounded-full mr-1.5"
                       [class]="admin.activo ? 'bg-green-600' : 'bg-red-600'"></span>
                     {{ obtenerTextoEstado(admin.activo) }}
                   </span>
                 </div>
               </div>
             </td>

             <!-- Actividad -->
             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
               <div class="space-y-1">
                 <div class="flex items-center">
                   <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                   </svg>
                   {{ formatearFecha(admin.ultimo_acceso || '') }}
                 </div>
                 <div class="text-xs text-gray-400">
                   {{ calcularDiasDesdeUltimoAcceso(admin.ultimo_acceso || '') }} días atrás
                 </div>
               </div>
             </td>

             <!-- Acciones -->
             <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
               <div class="flex items-center justify-end space-x-2">
                 <button (click)="verPerfilCompleto(admin)"
                   class="text-blue-600 hover:text-blue-900 transition-colors">
                   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                   </svg>
                 </button>

                 <button (click)="mostrarFormularioEditar(admin)"
                   class="text-orange-600 hover:text-orange-900 transition-colors">
                   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                   </svg>
                 </button>

                 <button (click)="mostrarCambioPassword(admin)"
                   class="text-gray-600 hover:text-gray-900 transition-colors">
                   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                   </svg>
                 </button>

                 <button (click)="cambiarEstado(admin)"
                   [class]="admin.activo ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'"
                   class="transition-colors">
                   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
                   </svg>
                 </button>

                 <button (click)="eliminarAdministrador(admin)"
                   class="text-red-600 hover:text-red-900 transition-colors">
                   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                   </svg>
                 </button>
               </div>
             </td>
           </tr>
         </tbody>
       </table>
     </div>
   </div>
 </div>
</div>

<!-- ==========================================
    MODAL PARA CREAR/EDITAR ADMINISTRADOR
    ========================================== -->
<div *ngIf="mostrarModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
 <!-- Overlay -->
 <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" (click)="cerrarModal()"></div>

 <!-- Modal content -->
 <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
   <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">

     <!-- Header del modal -->
     <div class="bg-white px-6 py-6 border-b border-gray-200">
       <div class="flex items-center justify-between">
         <div>
           <h3 class="text-2xl font-bold text-gray-900" id="modal-title">
             {{ isEditMode ? 'Editar Administrador' : 'Nuevo Administrador' }}
           </h3>
           <p class="mt-1 text-sm text-gray-600">
             {{ isEditMode ? 'Actualice la información del administrador' : 'Complete la información para crear un nuevo administrador' }}
           </p>
         </div>
         <button (click)="cerrarModal()"
           class="bg-white rounded-md text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
           <span class="sr-only">Cerrar</span>
           <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
           </svg>
         </button>
       </div>
     </div>

     <!-- Contenido del formulario -->
     <form [formGroup]="administradorForm" (ngSubmit)="onSubmit()" class="bg-white">
       <div class="px-6 py-6 space-y-8">

         <!-- Sección: Datos de Acceso -->
         <div>
           <div class="flex items-center mb-6">
             <div class="bg-blue-100 p-2 rounded-lg mr-3">
               <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
               </svg>
             </div>
             <div>
               <h4 class="text-lg font-semibold text-gray-900">Datos de Acceso al Sistema</h4>
               <p class="text-sm text-gray-600">Configuración de usuario y permisos</p>
             </div>
           </div>

           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <!-- Usuario -->
             <div>
               <label for="usuario" class="block text-sm font-medium text-gray-700 mb-2">
                 Nombre de Usuario <span class="text-red-500">*</span>
               </label>
               <input type="text" id="usuario" formControlName="usuario"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('usuario')?.errors && administradorForm.get('usuario')?.touched"
                 placeholder="Ejemplo: admin_hospital">
               <div *ngIf="administradorForm.get('usuario')?.errors?.['required'] && administradorForm.get('usuario')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El nombre de usuario es requerido
               </div>
               <div *ngIf="administradorForm.get('usuario')?.errors?.['minlength'] && administradorForm.get('usuario')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El usuario debe tener al menos {{ CONFIG.USUARIO_MIN_LENGTH }} caracteres
               </div>
             </div>

             <!-- Contraseña (solo en modo crear) -->
             <div *ngIf="!isEditMode">
               <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                 Contraseña <span class="text-red-500">*</span>
               </label>
               <input type="password" id="password" formControlName="password"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('password')?.errors && administradorForm.get('password')?.touched"
                 placeholder="Mínimo {{ CONFIG.PASSWORD_MIN_LENGTH }} caracteres">
               <div *ngIf="administradorForm.get('password')?.errors?.['required'] && administradorForm.get('password')?.touched"
                 class="mt-2 text-sm text-red-600">
                 La contraseña es requerida
               </div>
               <div *ngIf="administradorForm.get('password')?.errors?.['minlength'] && administradorForm.get('password')?.touched"
                 class="mt-2 text-sm text-red-600">
                 La contraseña debe tener al menos {{ CONFIG.PASSWORD_MIN_LENGTH }} caracteres
               </div>
             </div>

             <!-- Nivel de Acceso -->
             <div>
               <label for="nivel_acceso" class="block text-sm font-medium text-gray-700 mb-2">
                 Nivel de Acceso <span class="text-red-500">*</span>
               </label>
               <select id="nivel_acceso" formControlName="nivel_acceso"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('nivel_acceso')?.errors && administradorForm.get('nivel_acceso')?.touched">
                 <option *ngFor="let nivel of nivelesAcceso" [value]="nivel.valor">
                   {{ nivel.etiqueta }} - {{ nivel.descripcion }}
                 </option>
               </select>
               <div *ngIf="administradorForm.get('nivel_acceso')?.errors?.['required'] && administradorForm.get('nivel_acceso')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El nivel de acceso es requerido
               </div>
             </div>

             <!-- Estado -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-3">Estado del Usuario</label>
               <div class="flex items-center space-x-6">
                 <label class="flex items-center">
                   <input type="radio" formControlName="activo" [value]="true"
                     class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                   <span class="ml-2 text-sm text-gray-700">Activo</span>
                 </label>
                 <label class="flex items-center">
                   <input type="radio" formControlName="activo" [value]="false"
                     class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                   <span class="ml-2 text-sm text-gray-700">Inactivo</span>
                 </label>
               </div>
             </div>
           </div>
         </div>

         <!-- Sección: Información Personal -->
         <div>
           <div class="flex items-center mb-6">
             <div class="bg-green-100 p-2 rounded-lg mr-3">
               <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
               </svg>
             </div>
             <div>
               <h4 class="text-lg font-semibold text-gray-900">Información Personal</h4>
               <p class="text-sm text-gray-600">Datos personales del administrador</p>
             </div>
           </div>

           <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
             <!-- Nombre -->
             <div>
               <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
                 Nombre <span class="text-red-500">*</span>
               </label>
               <input type="text" id="nombre" formControlName="nombre"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('nombre')?.errors && administradorForm.get('nombre')?.touched"
                 placeholder="Nombre del administrador">
               <div *ngIf="administradorForm.get('nombre')?.errors?.['required'] && administradorForm.get('nombre')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El nombre es requerido
               </div>
             </div>

             <!-- Apellido Paterno -->
             <div>
               <label for="apellido_paterno" class="block text-sm font-medium text-gray-700 mb-2">
                 Apellido Paterno <span class="text-red-500">*</span>
               </label>
               <input type="text" id="apellido_paterno" formControlName="apellido_paterno"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('apellido_paterno')?.errors && administradorForm.get('apellido_paterno')?.touched"
                 placeholder="Apellido paterno">
               <div *ngIf="administradorForm.get('apellido_paterno')?.errors?.['required'] && administradorForm.get('apellido_paterno')?.touched"class="mt-2 text-sm text-red-600">
                 El apellido paterno es requerido
               </div>
             </div>

             <!-- Apellido Materno -->
             <div>
               <label for="apellido_materno" class="block text-sm font-medium text-gray-700 mb-2">
                 Apellido Materno
               </label>
               <input type="text" id="apellido_materno" formControlName="apellido_materno"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 placeholder="Apellido materno (opcional)">
             </div>

             <!-- Fecha de Nacimiento -->
             <div>
               <label for="fecha_nacimiento" class="block text-sm font-medium text-gray-700 mb-2">
                 Fecha de Nacimiento <span class="text-red-500">*</span>
               </label>
               <input type="date" id="fecha_nacimiento" formControlName="fecha_nacimiento"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('fecha_nacimiento')?.errors && administradorForm.get('fecha_nacimiento')?.touched">
               <div *ngIf="administradorForm.get('fecha_nacimiento')?.errors?.['required'] && administradorForm.get('fecha_nacimiento')?.touched"
                 class="mt-2 text-sm text-red-600">
                 La fecha de nacimiento es requerida
               </div>
             </div>

             <!-- Género -->
             <div>
               <label for="genero" class="block text-sm font-medium text-gray-700 mb-2">
                 Género <span class="text-red-500">*</span>
               </label>
               <select id="genero" formControlName="genero"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 [class.border-red-300]="administradorForm.get('genero')?.errors && administradorForm.get('genero')?.touched">
                 <option value="">Seleccione un género</option>
                 <option *ngFor="let genero of opcionesGenero" [value]="genero.valor">
                   {{ genero.etiqueta }}
                 </option>
               </select>
               <div *ngIf="administradorForm.get('genero')?.errors?.['required'] && administradorForm.get('genero')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El género es requerido
               </div>
             </div>

             <!-- Estado Civil -->
             <div>
               <label for="estado_civil" class="block text-sm font-medium text-gray-700 mb-2">
                 Estado Civil
               </label>
               <select id="estado_civil" formControlName="estado_civil"
                 class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                 <option value="">Seleccione estado civil</option>
                 <option *ngFor="let estado of estadosCiviles" [value]="estado.valor">
                   {{ estado.etiqueta }}
                 </option>
               </select>
             </div>
           </div>
         </div>

         <!-- Sección: Información de Contacto -->
         <div>
           <div class="flex items-center mb-6">
             <div class="bg-purple-100 p-2 rounded-lg mr-3">
               <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
               </svg>
             </div>
             <div>
               <h4 class="text-lg font-semibold text-gray-900">Información de Contacto</h4>
               <p class="text-sm text-gray-600">Datos para comunicación</p>
             </div>
           </div>

           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <!-- Email -->
             <div>
               <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                 Correo Electrónico <span class="text-red-500">*</span>
               </label>
               <div class="relative">
                 <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                   <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                   </svg>
                 </div>
                 <input type="email" id="email" formControlName="email"
                   class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                   [class.border-red-300]="administradorForm.get('email')?.errors && administradorForm.get('email')?.touched"
                   placeholder="ejemplo@hospital.gob.mx">
               </div>
               <div *ngIf="administradorForm.get('email')?.errors?.['required'] && administradorForm.get('email')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El correo electrónico es requerido
               </div>
               <div *ngIf="administradorForm.get('email')?.errors?.['email'] && administradorForm.get('email')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El formato del correo electrónico no es válido
               </div>
             </div>

             <!-- Teléfono -->
             <div>
               <label for="telefono" class="block text-sm font-medium text-gray-700 mb-2">
                 Teléfono
               </label>
               <div class="relative">
                 <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                   <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                   </svg>
                 </div>
                 <input type="tel" id="telefono" formControlName="telefono"
                   class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                   [class.border-red-300]="administradorForm.get('telefono')?.errors && administradorForm.get('telefono')?.touched"
                   placeholder="4621234567">
               </div>
               <div *ngIf="administradorForm.get('telefono')?.errors?.['pattern'] && administradorForm.get('telefono')?.touched"
                 class="mt-2 text-sm text-red-600">
                 El teléfono debe tener exactamente 10 dígitos
               </div>
               <p class="mt-1 text-xs text-gray-500">Formato: 10 dígitos sin espacios ni guiones</p>
             </div>
           </div>
         </div>
       </div>

       <!-- Footer del modal -->
       <div class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200">
         <div class="flex items-center text-sm text-gray-500">
           <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
           </svg>
           Los campos marcados con <span class="text-red-500 font-medium">*</span> son obligatorios
         </div>

         <div class="flex items-center space-x-3">
           <button type="button" (click)="cerrarModal()"
             class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
             Cancelar
           </button>

           <button type="submit" [disabled]="procesandoFormulario || administradorForm.invalid"
             class="inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
             <div *ngIf="procesandoFormulario" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white">
               <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
               </svg>
             </div>
             {{ isEditMode ? 'Actualizar Administrador' : 'Crear Administrador' }}
           </button>
         </div>
       </div>
     </form>
   </div>
 </div>
</div>

<!-- ==========================================
    MODAL PARA VER PERFIL COMPLETO
    ========================================== -->
<div *ngIf="mostrarModalPerfil && administradorSeleccionado" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-perfil-title" role="dialog" aria-modal="true">
 <!-- Overlay -->
 <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" (click)="cerrarModalPerfil()"></div>

 <!-- Modal content -->
 <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
   <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl">

     <!-- Header del modal -->
     <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-6 text-white">
       <div class="flex items-center justify-between">
         <div class="flex items-center">
           <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-white font-bold text-xl">
             {{ obtenerIconoPorNivel(administradorSeleccionado.nivel_acceso) }}
           </div>
           <div class="ml-4">
             <h3 class="text-xl font-bold" id="modal-perfil-title">
               {{ administradorSeleccionado.usuario }}
             </h3>
             <p class="text-blue-100">
               {{ construirNombreCompleto(administradorSeleccionado) }}
             </p>
           </div>
         </div>
         <button (click)="cerrarModalPerfil()"
           class="bg-white bg-opacity-20 rounded-md text-white hover:bg-opacity-30 focus:outline-none focus:ring-2 focus:ring-white">
           <span class="sr-only">Cerrar</span>
           <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
           </svg>
         </button>
       </div>
     </div>

     <!-- Contenido del perfil -->
     <div class="bg-white px-6 py-6">
       <div class="space-y-8">

         <!-- Información del Sistema -->
         <div>
           <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
             <svg class="w-5 h-5 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
             </svg>
             Información del Sistema
           </h4>
           <div class="bg-gray-50 rounded-lg p-4 space-y-4">
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
               <div>
                 <label class="block text-sm font-medium text-gray-500">Usuario</label>
                 <p class="mt-1 text-sm font-medium text-gray-900">{{ administradorSeleccionado.usuario }}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-500">Nivel de Acceso</label>
                 <span class="mt-1 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                   [class]="obtenerColorPorNivel(administradorSeleccionado.nivel_acceso)">
                   {{ administradorSeleccionado.nivel_acceso }}
                 </span>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-500">Estado</label>
                 <span class="mt-1 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                   [class]="obtenerClaseEstado(administradorSeleccionado.activo)">
                   <span class="w-1.5 h-1.5 rounded-full mr-1.5"
                     [class]="administradorSeleccionado.activo ? 'bg-green-600' : 'bg-red-600'"></span>
                   {{ obtenerTextoEstado(administradorSeleccionado.activo) }}
                 </span>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-500">Último Acceso</label>
                 <p class="mt-1 text-sm text-gray-900">{{ formatearFecha(administradorSeleccionado.ultimo_acceso || '') }}</p>
               </div>
             </div>
           </div>
         </div>

         <!-- Información Personal -->
         <div *ngIf="administradorSeleccionado.persona">
           <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
             <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
             </svg>
             Información Personal
           </h4>
           <div class="bg-gray-50 rounded-lg p-4">
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
               <div>
                 <label class="block text-sm font-medium text-gray-500">Nombre Completo</label>
                 <p class="mt-1 text-sm font-medium text-gray-900">{{ construirNombreCompleto(administradorSeleccionado) }}</p>
               </div>
               <div *ngIf="administradorSeleccionado.persona.genero">
                 <label class="block text-sm font-medium text-gray-500">Género</label>
                 <p class="mt-1 text-sm text-gray-900">
                   {{ administradorSeleccionado.persona.genero === 'M' ? 'Masculino' : 'Femenino' }}
                 </p>
               </div>
               <div *ngIf="administradorSeleccionado.persona.fecha_nacimiento">
                 <label class="block text-sm font-medium text-gray-500">Fecha de Nacimiento</label>
                 <p class="mt-1 text-sm text-gray-900">{{ formatearFecha(administradorSeleccionado.persona.fecha_nacimiento) }}</p>
               </div>
               <div *ngIf="administradorSeleccionado.persona.email">
                 <label class="block text-sm font-medium text-gray-500">Email</label>
                 <p class="mt-1 text-sm text-gray-900">{{ administradorSeleccionado.persona.email }}</p>
               </div>
               <div *ngIf="administradorSeleccionado.persona.telefono">
                 <label class="block text-sm font-medium text-gray-500">Teléfono</label>
                 <p class="mt-1 text-sm text-gray-900">{{ administradorSeleccionado.persona.telefono }}</p>
               </div>
             </div>
           </div>
         </div>
       </div>
     </div>

     <!-- Footer del modal -->
     <div class="bg-gray-50 px-6 py-4 flex items-center justify-end space-x-3 border-t border-gray-200">
       <button (click)="mostrarFormularioEditar(administradorSeleccionado!)"
         class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
         </svg>
         Editar
       </button>

       <button (click)="cerrarModalPerfil()"
         class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
         Cerrar
       </button>
     </div>
   </div>
 </div>
</div>

<!-- ==========================================
    MODAL PARA CAMBIAR CONTRASEÑA
    ========================================== -->
<div *ngIf="mostrarModalPassword && administradorSeleccionado" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-password-title" role="dialog" aria-modal="true">
 <!-- Overlay -->
 <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" (click)="cerrarModalPassword()"></div>

 <!-- Modal content -->
 <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
   <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md">

     <!-- Header del modal -->
     <div class="bg-white px-6 py-6 border-b border-gray-200">
       <div class="flex items-center justify-between">
         <div>
           <h3 class="text-lg font-semibold text-gray-900" id="modal-password-title">
             Cambiar Contraseña
           </h3>
           <p class="mt-1 text-sm text-gray-600">
             Usuario: {{ administradorSeleccionado.usuario }}
           </p>
         </div>
         <button (click)="cerrarModalPassword()"
           class="bg-white rounded-md text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
           <span class="sr-only">Cerrar</span>
           <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
           </svg>
         </button>
       </div>
     </div>

     <!-- Contenido del formulario -->
     <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()" class="bg-white px-6 py-6">
       <div class="space-y-6">

         <!-- Contraseña Actual -->
         <div>
           <label for="password_actual" class="block text-sm font-medium text-gray-700 mb-2">
             Contraseña Actual <span class="text-red-500">*</span>
           </label>
           <input type="password" id="password_actual" formControlName="password_actual"
             class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
             [class.border-red-300]="passwordForm.get('password_actual')?.errors && passwordForm.get('password_actual')?.touched"
             placeholder="Ingrese la contraseña actual">
           <div *ngIf="passwordForm.get('password_actual')?.errors?.['required'] && passwordForm.get('password_actual')?.touched"
             class="mt-2 text-sm text-red-600">
             La contraseña actual es requerida
           </div>
         </div>

         <!-- Nueva Contraseña -->
         <div>
           <label for="password_nuevo" class="block text-sm font-medium text-gray-700 mb-2">
             Nueva Contraseña <span class="text-red-500">*</span>
           </label>
           <input type="password" id="password_nuevo" formControlName="password_nuevo"
             class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
             [class.border-red-300]="passwordForm.get('password_nuevo')?.errors && passwordForm.get('password_nuevo')?.touched"
             placeholder="Ingrese la nueva contraseña">
           <div *ngIf="passwordForm.get('password_nuevo')?.errors?.['required'] && passwordForm.get('password_nuevo')?.touched"
             class="mt-2 text-sm text-red-600">
             La nueva contraseña es requerida
           </div>
           <div *ngIf="passwordForm.get('password_nuevo')?.errors?.['minlength'] && passwordForm.get('password_nuevo')?.touched"
             class="mt-2 text-sm text-red-600">
             La nueva contraseña debe tener al menos {{ CONFIG.PASSWORD_MIN_LENGTH }} caracteres
           </div>
         </div>

         <!-- Confirmar Contraseña -->
         <div>
           <label for="confirmar_password" class="block text-sm font-medium text-gray-700 mb-2">
             Confirmar Nueva Contraseña <span class="text-red-500">*</span>
           </label>
           <input type="password" id="confirmar_password" formControlName="confirmar_password"
             class="block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
             [class.border-red-300]="passwordForm.get('confirmar_password')?.errors && passwordForm.get('confirmar_password')?.touched"
             placeholder="Confirme la nueva contraseña">
           <div *ngIf="passwordForm.get('confirmar_password')?.errors?.['required'] && passwordForm.get('confirmar_password')?.touched"
             class="mt-2 text-sm text-red-600">
             La confirmación de contraseña es requerida
           </div>
         </div>

         <!-- Indicador de seguridad -->
         <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
           <div class="flex">
             <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
             </svg>
             <div>
               <h4 class="text-sm font-medium text-blue-900">Recomendaciones de Seguridad</h4>
               <ul class="mt-2 text-xs text-blue-800 space-y-1">
                 <li>• Mínimo {{ CONFIG.PASSWORD_MIN_LENGTH }} caracteres</li>
                 <li>• Incluya mayúsculas, minúsculas y números</li>
                 <li>• Evite palabras comunes o datos personales</li>
               </ul>
             </div>
           </div>
         </div>
       </div>

       <!-- Footer del modal -->
       <div class="flex items-center justify-end space-x-3 pt-6 border-t border-gray-200 mt-6">
         <button type="button" (click)="cerrarModalPassword()"
           class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
           Cancelar
         </button>

         <button type="submit" [disabled]="passwordForm.invalid"
           class="inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
           <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
           </svg>
           Actualizar Contraseña
         </button>
       </div>
     </form>
   </div>
 </div>
</div>
